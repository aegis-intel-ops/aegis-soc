

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    
    # Basic Auth globally
    auth_basic "Restricted Access - Aegis SOC";
    auth_basic_user_file /etc/nginx/.htpasswd;
    
    # Proxy Headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # 1. Main Dashboard (Root Domain)
    server {
        listen 80;
        server_name 129.213.117.130.nip.io;
        location / { proxy_pass http://main-dashboard:80; }
    }

    # 2. SOC Core (Dashboard + API)
    server {
        listen 80;
        server_name soc.129.213.117.130.nip.io;
        location / { proxy_pass http://soc-dashboard:80; }
        location /api/ { proxy_pass http://soc-core:8030; }
    }

    # 3. OSINT (Dashboard + API)
    server {
        listen 80;
        server_name osint.129.213.117.130.nip.io;
        location / { proxy_pass http://osint-dashboard:80; }
        location /api/ { proxy_pass http://osint:8000; }
    }

    # 4. Shodan (Dashboard only)
    server {
        listen 80;
        server_name shodan.129.213.117.130.nip.io;
        location / { proxy_pass http://shodan-dashboard:80; }
        location /api/ { proxy_pass http://osint:8000; }
    }

    # 5. AI Protection (Dashboard + API)
    server {
        listen 80;
        server_name ai.129.213.117.130.nip.io;
        location / { proxy_pass http://ai-protect-dashboard:80; }
        location /api/ { proxy_pass http://ai-protect:8010; }
    }

    # 6. Voice Protection (Dashboard + API)
    server {
        listen 80;
        server_name voice.129.213.117.130.nip.io;
        location / { proxy_pass http://voice-protect-dashboard:80; }
        location /api/ { proxy_pass http://voice-protect:8020; }
    }

    # 7. SpiderFoot
    server {
        listen 80;
        server_name spiderfoot.129.213.117.130.nip.io;
        location / { proxy_pass http://spiderfoot:5001; }
    }


}
