version: '3.8'

services:
  # ===== Security Gateway =====
  gateway:
    build: ./services/gateway
    container_name: aegis-gateway
    ports:
      - "80:80"
    restart: unless-stopped
    depends_on:
      - main-dashboard
      - soc-dashboard
      - osint-dashboard

  # ===== API Services =====

  osint:
    build: ./services/osint
    container_name: aegis-osint
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - SHODAN_API_KEY=${SHODAN_API_KEY:-}
      - SPIDERFOOT_URL=http://spiderfoot:5001

  spiderfoot:
    build:
      context: ./services/spiderfoot
      dockerfile: Dockerfile
    container_name: aegis-spiderfoot
    restart: unless-stopped

  ai-protect:
    build: ./services/ai-protect
    container_name: aegis-ai-protect
    restart: unless-stopped
    volumes:
      - ./data/ai-protect:/app/data
    environment:
      - PYTHONUNBUFFERED=1

  voice-protect:
    build: ./services/voice-protect
    container_name: aegis-voice-protect
    restart: unless-stopped
    volumes:
      - ./data/voice-protect:/app/data
    environment:
      - PYTHONUNBUFFERED=1

  soc-core:
    build: ./services/soc-core
    container_name: aegis-soc-core
    restart: unless-stopped
    volumes:
      - ./data/soc:/app/data
    environment:
      - PYTHONUNBUFFERED=1

  # ===== Dashboards =====

  osint-dashboard:
    build: ./dashboards/osint-dashboard
    container_name: aegis-osint-dashboard
    restart: unless-stopped

  shodan-dashboard:
    build: ./dashboards/shodan-dashboard
    container_name: aegis-shodan-dashboard
    restart: unless-stopped

  ai-protect-dashboard:
    build: ./dashboards/ai-protect-dashboard
    container_name: aegis-ai-dashboard
    restart: unless-stopped

  voice-protect-dashboard:
    build: ./dashboards/voice-protect-dashboard
    container_name: aegis-voice-dashboard
    restart: unless-stopped

  soc-dashboard:
    build: ./dashboards/soc-dashboard
    container_name: aegis-soc-dashboard
    restart: unless-stopped

  main-dashboard:
    build: ./dashboards/main-dashboard
    container_name: aegis-main-dashboard
    restart: unless-stopped

volumes:
  data:
